# 如何查看实验结果

## 📁 结果文件位置（两处）

### 1. Java 端（最详细）⭐

```
cloudsimplus-gateway/results/{实验名称}/
├── cloudlets.csv  ← 每个任务的执行详情
├── vms.csv        ← VM 利用率统计
└── host*.csv      ← 每个主机的历史
```

### 2. Python 端（训练数据）

```
logs/{实验类型}/{实验名}/
├── monitor.csv              ← 每个 episode 的总结
├── best_episode_details.csv ← 最佳 episode 的每一步
└── progress.csv             ← 训练进度
```

---

## 📊 重要文件解读

### cloudlets.csv（任务执行记录）

```csv
ID,Status,VM ID,ArrivalTime,StartTime,FinishTime,ExecTime,WaitTime,Cost
0,SUCCESS,7,0,1,4,4,1,$25.53
1,SUCCESS,9,6,6,17,11,0,$103.91
```

**字段说明**:
- `Status`: SUCCESS = 完成，FAILED = 失败
- `ArrivalTime`: 任务到达时间（秒）
- `WaitTime`: 等待分配的时间
- `ExecTime`: 实际执行时间
- `Cost`: 该任务的执行成本

---

### vms.csv（VM 统计）

```csv
ID,Type,Status,PEs,CPU Util %,Cost $
0,S,IDLE,2,0.0,$202.84    ← 小VM，0%利用率，浪费！
9,M,IDLE,4,39.3,$396.68   ← 中VM，39.3%利用率
12,L,IDLE,8,62.5,$784.36  ← 大VM，62.5%利用率
```

**重要**:
- `IDLE`: VM 空闲状态（episode 结束时）
- `CPU Util %`: **平均利用率**（整个 episode）
  - 0% = 从未使用（浪费）
  - 39.3% = 使用过，中等利用率
  - 62.5% = 使用过，较高利用率
- `Cost $`: **总成本**（不是单位成本！）
  - 按分配的资源付费，不管用没用
  - 0% 利用率也要付全额！

**成本计算**:
```
Small VM (2核) = 2 × $0.086/小时 × 220秒 / 3600 ≈ $202.84
Medium VM (4核) = 4 × $0.086/小时 × 220秒 / 3600 ≈ $396.68
Large VM (8核) = 8 × $0.086/小时 × 220秒 / 3600 ≈ $784.36
```

---

### monitor.csv（Episode 总结）

```csv
r,l,t,reward_wait_time,reward_unutilization,...
-172.32,220,3.52,-0.0,-0.446,...
-180.95,220,5.59,-2.77,-0.510,...
```

**字段**:
- `r`: Episode 总奖励
- `l`: Episode 长度（步数）
- `t`: 运行时长（秒）
- 其他: 各奖励组件

---

## 🐛 **发现的问题（Experiment 5）**

### 问题 1: Episode 太短 ❌

```
工作负载: 112 个任务（0-198 秒到达）
Episode 长度: 220 秒（太短！）
任务执行时间: 4-11 秒/任务

结果: 只有前 3 个任务能完成，其余 109 个还在执行中就 episode 结束了
```

### 问题 2: VM 资源浪费 ❌

```
总共 14 个 VM:
- 11 个 VM: 0% 利用率（完全浪费 $2,231）
- 2 个 VM: 有使用（39.3%, 62.5%）
- 1 个 VM: 0% 但创建了

资源浪费率: 11/14 = 78.6%
```

---

## ✅ **解决方案（已修复）**

我已经将 `max_episode_length` 从 220 改为 **500**：

```yaml
experiment_5:
  max_episode_length: 500  # 足够时间让所有112个任务完成
```

**预期改进**:
- ✅ ~100 个任务能完成（而不是只有 3 个）
- ✅ 看到真实的学习曲线
- ✅ 奖励会有显著变化

---

## 🚀 **重新运行修复后的实验**

```powershell
# 重启 Java Gateway
# 终端 1
cd cloudsimplus-gateway
.\gradlew.bat run

# 终端 2
cd F:\rl-cloudsim-loadbalancer
.\drl-manager\venv\Scripts\Activate.ps1
$env:EXPERIMENT_ID="experiment_5"
python .\drl-manager\mnt\entrypoint.py
```

**这次应该看到**:
- ✅ ~100 个 cloudlets 完成（在 `cloudlets.csv`）
- ✅ 更多 VM 被使用
- ✅ 奖励有明显变化和改善

---

## 📈 **如何判断实验是否成功**

### ✅ 成功的标志

查看 Java 日志最后：
```
Total cost of executing XX Cloudlets = $XXXX.XX
```
- ✅ XX > 80（至少80%任务完成）

查看 `monitor.csv`:
```
Episode 1: -500
Episode 2: -450  ← 奖励在改善
Episode 3: -420  ← 继续改善
```

### ❌ 失败的标志

```
Total cost of executing 3 Cloudlets = $189  ← 太少！
```

```
Episode 1: -172
Episode 2: -180  ← 奖励波动但不改善
Episode 3: -169
```

---

**现在重新运行 Experiment 5，应该能看到正常的任务执行了！** 🎯
